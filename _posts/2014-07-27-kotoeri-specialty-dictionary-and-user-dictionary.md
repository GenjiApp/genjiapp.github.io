---
title: ことえりの追加辞書とシステムのユーザ辞書
layout: post
tags: [os x, kotoeri]
---
　OS X 10.9 Mavericksのことえりで、ユーザ定義の単語を日本語変換できるようにする方法は2種類ある。

- ことえりの追加辞書
- システムのユーザ辞書

## ことえりの追加辞書

　ことえりの追加辞書は、

- 読み
- 単語
- 品詞

をセットで登録するので、活用がない体言（名詞）や定型文だけでなく、活用がある用言（動詞、形容詞、形容動詞）や接頭語、接尾語を登録できる。
　iCloud同期の対象外であり、これで登録した単語は他端末では利用できない。
　また、ことえりの追加辞書を登録するには所定のフォーマットと文字エンコーディングを用いたテキストファイルを作成する必要がある。登録した単語を修正する際は、元のテキストファイル（もしくは登録済みの辞書から書き出したテキストファイル）を修正し、修正したテキストファイルを再度登録して置きかえるなど手間がかかる。

　テキストファイルは、

```
"ぴんふ", "平和", "普通名詞"
"あがる", "和了る", "ラ行五段"
```

のようなフォーマットで、文字エンコーディングはShift-JISかUTF-16を用いる。フォーマットはCSV的だが、ファイルの拡張子を`csv`にすると受け付けてくれないので、`txt`で作成する。

　用意したテキストファイルを、システム環境設定の「キーボード」→「入力ソース」→「ことえり」→「追加辞書:」のリストにドラッグ＆ドロップすることで登録できる。「追加辞書:」リストがスクロールした一番下という解りにくい場所にあるので注意（「ことえり」の環境設定ヴューがスクロールできるということに気付きにくい）。

![](/blog/img/20140727/specialty_dictionary.png)

　「追加辞書:」リストを右クリック（`Control`-クリック）で辞書の書き出しや削除、チェックボックスで辞書の使用・不使用を選択できる。


## システムのユーザ辞書

　システムのユーザ辞書は、

- 読み
- 単語

のみで、品詞を登録できないので、活用がある用言は登録できない（してもしょうがない）。たとえば「あがる／和了る」という単語を登録した場合、「あがる」で「和了る」は変換できるが「あがらない」で「和了らない」は変換できない。すべての活用形を登録するのは現実的ではない。
　iCloud同期の対象であり、ひとつの端末で登録した単語が他端末でも利用できるようになる。GUIでの編集とテキストファイルによる一括登録両方利用できる。

　GUIで単語登録する場合は、システム環境設定の「キーボード」→「ユーザ辞書」で編集する。

![](/blog/img/20140727/user_dictionary.png)

　一括登録する際に用いるファイルフォーマットはOS Xのプロパティリストファイル（拡張子`plist`）で、

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<array>
	<dict>
		<key>phrase</key>
		<string>平和</string>
		<key>shortcut</key>
		<string>ぴんふ</string>
		<key>timestamp</key>
		<integer>0</integer>
	</dict>
	<dict>
		<key>phrase</key>
		<string>立直</string>
		<key>shortcut</key>
		<string>りーち</string>
		<key>timestamp</key>
		<integer>0</integer>
	</dict>
</array>
</plist>
```

のような形式になる。重要なのは`phrase`と`shortcat`で、`timestamp`は適当で良いと思う。テキストエディタで作成しても良いし、Xcodeがプロパティリストファイルに対応しているので利用しても良い。
　作成したプロパティリストをシステム環境設定の「キーボード」→「ユーザ辞書」のリストにドラッグ＆ドロップすることで一括登録できる。リストの単語を選択し、Finder等にドラッグ＆ドロップすることで書き出しも可能。

### 品詞登録用のカラムは存在する

　システムのユーザ辞書はsqlite3のデータベースとして保存されているが、その中身を覗いてみると、`ZPARTOFSPEECH`なるカラムが存在していることが解る。「Z PART OF SPEECH」＝「Part of Speech」＝「品詞」と解釈できる。実際、OS X 10.9 Mavericks以前のシステムで登録されていた単語が移行されたと思しきエントリィが存在し、その中では`ZPARTOFSPEECH`カラムに品詞の情報が登録されている。
　しかしながら、品詞を登録する正規のUIは存在しておらず、sqlite3を用いて直接データベースを編集して品詞を登録してみても、それが日本語変換に反映されることはなかった。とは言え、データベース上に品詞を登録するカラムが用意されていることから、将来的にはその内容が有効になり、品詞登録用のUIも用意される可能性があるかもしれない。


## まとめ

　登録したい単語は大抵が名詞か定型文なので、基本的にはGUIがあってiCloud同期対応のシステムのユーザ辞書を用い、用言を登録したい場合はことえりの追加辞書形式を用いるのが良いと思う。

　今回の調査は麻雀用語を一括で登録したいという思いから行った。成果物をGitHubに公開したので、興味のあるひとは

- [GenjiApp/Mahjong-Terms-Dictionary-for-Kotoeri-and-iOS](https://github.com/GenjiApp/Mahjong-Terms-Dictionary-for-Kotoeri-and-iOS)

を参照のこと。


